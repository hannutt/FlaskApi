<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/jquery-ui.min.js"
        integrity="sha512-MSOo1aY+3pXCOCdGAYoBZ6YGI0aragoQsg1mKKBHXCYPIWxamwOE7Drh+N5CPgGI5SA9IEKJiPjdfqWFWmZtRA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/themes/base/jquery-ui.min.css"
        integrity="sha512-TFee0335YRJoyiqz8hA8KV3P0tXa5CpRBSoM0Wnkn7JoJx1kaq1yXL/rb8YFpWXkMOjRcv5txv+C6UluttluCQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script type="text/javascript" src="{{ url_for('static', filename = 'js/scripts.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename = 'js/menuScripts.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename = 'js/DynamicCreate.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename = 'js/sqliteScript.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename = 'js/sqliteScript2.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename = 'js/statistic.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <title>Flask-APi</title>

<body class="indexbody">

    <p id="paths" hidden class="paths">{{dirsFinal}}</p>
    <h4 id="apiName">SQL & NoSQL management tool</h4>
    <!--Flask api animaatio näytetään näin myös selectcol.html sivulla
    {% block content %}
    {% endblock %}-->
    <p hidden id="dbTotal">{{amountOfdb}}</p>
    <p hidden id="dbL">
    </p>
    <!--kokoelmien nimi,koko yms tietojen läpikäynti silmukassa, tiedot tuodaan sivulle stats-listassa-->
    {% for j in stats %}
    <p hidden id="stats" class="statsNames">{{j}}</p>
    {%endfor%}
    <!--tietokantojen koot-->
    {% for i in statsNums %}
    <div id="statsNums" hidden class="statsNums">{{i}}</div>
    {% endfor %}
    <p hidden class="allStat">{{allStats}}</p>

    <script>
        //jquery animate funktion kutsu ja suoritus sivun latauksen yhteydessä
        $(document).ready(function () {
            $("#apiName").animate({
                width: "70%",
                opacity: 0.9,
                marginLeft: "0.6in",
                fontSize: "3em",
                borderWidth: "10px",
            }, 1500);
        });

        getNumValues()
    </script>

    <p id="demo"></p>

    <div class="hideAll">
        <p id="selection" class="selection"></p>

        <button hidden id="hideBtn">Hide</button>
    </div>

    <label class="dbsLbl" for="dbs">Access to local Mongo database:</label>

    <form action="{{ url_for('read_form')}}" method="post">
        <select name="dbs" id="dbs" onchange="getSelectedText(this)">

            <option value="default" selected>Select Database</option>
            <!--
          <option value="mongodb://localhost:27017/quizDB">quizDB</option>
          kokoelmien nimien lisäys pudotusvalikkoon-->
            {% for each in dbsList %}
            <option value="mongodb://localhost:27017/{{each}}">{{each}}</option>
            {% endfor %}
        </select>
        <select hidden name="atlasDB" id="atlasDB" onchange="getSelectedDataBase(this)">
            <option value="default" selected>Select Atlas DB</option>
            {% for i in dbsAtlas %}
            <option value="">{{i}}</option>
            {%endfor%}
        </select>
        <script>
            //jquery-funktio buttonin piilottamiseen
            $("#hideBtn").click(function () {
                $(".hideAll").hide("slow");
            });
        </script>

        <input hidden type="text" name="selectedDB" id="selectedDB">
        <!--tässä näytetään dropdown valittu database-->
        <input type="text" name="DBname" id="DBname">
        <button class="selectBtn">Select</button>
    </form>
    <br><br>
    <label for="atlas" class="atlasLbl">Access to Atlas DB</label>
    <input type="checkbox" class="atlasCB" id="atlas" name="atlas" onclick="createAtlas()">
    <br><br>

    <form action="{{ url_for('cloudConnection.readAtlasDB')}}" method="post">
        <div class="atlasForm" id="atlasForm">
        </div>
    </form>
    </div>
    {% include 'mysqlSelect.html' %}

    <form action="{{ url_for('sqliteScripts.readDBname')}}" method="post">
        {% include 'sqliteSelect.html' %}
    </form>
    <br><br>
    <form action="{{ url_for('sqliteScripts2.searchFromFolder')}}" method="post">
        <label hidden for="srcFolder" id="searchFolderLbl">Search the folder:</label>
        <input hidden type="checkbox" id="searchFolderCB" onchange="showSearchOptions()">
        <input hidden type="text" name="srcFolder" id="srcFolder" onchange="getInputValue()">
        <button class="runBtn" hidden id="searchFolderBtn">Search from </button>
    </form>


    </form>
    <br>
    <form action="{{ url_for('sqliteScripts.readInput')}}" method="post">
        <input hidden type="text" placeholder="db-file path" id="dbPath" name="dbPath">
        <br><br>
        <button hidden class="runBtn" id="accessBtn">Access</button>

    </form>
    <select onchange="selectionSqlite(this)">
        {% for t in tables %}
        <option>{{t}}</option>
        {%endfor%}
    </select>

    <script>
        //jquery autocomplete funktio
        $(function () {
            var paths = document.getElementsByClassName("paths")
            var pathNames = paths[0].innerHTML
            var pathList = pathNames.split(",")
            var newPathList = []
            //käydään pathList listan sisältö läpi
            for (var i = 0; i < pathList.length; i++) {
                var item = pathList[i]
                //jos sisällön merkkijonot sisältävät kaksi \\ merkkiä niin korvataan replacen
                //avulla \\ merkit \ merkiksi ja ' ' merkit tyhjällä ja lisätään se uuteen (newpathlist) listaan.
                if (item.includes("\\\\") && item.includes("'") && item.includes("'")) {
                    var itemRep = item.replace("\\\\", "\\").replace("'", "").replace("'", "").replace("[", "").replace("]", "")
                    newPathList.push(itemRep)
                }
            }


            $('#dbPath').autocomplete({
                source: newPathList
            })
        })
    </script>
    <select hidden name="sqliteInput" id="sqliteInput" onclick="sqliteSelection(this.value)">
        <option value="default" selected>Select Table</option>
        <!--sql tietokantojen näyttö select komponentissa-->
        {% for t in tables %}
        <option value="">{{t}}</option>
        {% endfor %}
    </select>


    <!--jos sqlitetables on true näytetään allaoleva input kenttä-->
    {% if sqliteTables==True%}
    <form action="{{ url_for('sqliteScripts.showSqliteTables')}}" method="post">

        <p id="selectedSqliteDB">{{dbname}}</p>

        <br>
        <!--huomaa oninput eventti, koska teksti lisätään jquery funktiolla tähän inputtii
        täytyy kentän merkkijonon tarkkailu tehdä oninputilla ja eri funktiolla-->
        <input type="text" id="sqliteFile" name="sqliteFile" placeholder="File path" oninput="clearBackup(this.value)">

        <button id="selectBtn" name="selectBtn" class="runBtn" onclick="showButton()">Select</button>
    </form>
    <form action="{{ url_for('sqliteScripts.createSqliteTable')}}" method="post">
        <input hidden type="text" id="sqliteFile2" name="sqliteFile2">

        <label hidden id="createTableLbl" for="createTableCB" class="createTableLbl"></label>
        <input hidden id="createTableCB" type="checkbox" onchange="createSqliteTable()">
        <div id="texta">

        </div>


        <form action="{{ url_for('sqliteScripts.backUpDB')}}" method="post">
            <label hidden id="backupLbl" for="backup" class="backupLbl">Backup this database</label>
            <input hidden type="checkbox" id="backup" onchange="startBackup()">
            <input hidden type="text" name="sqliteBase" id="sqliteBase">
            <button hidden id="backupBtn">Backup</button>
        </form>

        <select name="sqlitetable" id="sqlitetable" class="sqlitetable" onchange="selectionSqlite(this)">
            <option value="default" selected>Select Table</option>
            <!--sql tietokantojen näyttö select komponentissa-->
            {% for s in sqlTables %}
            <option value="">{{s}}</option>
            {% endfor %}
        </select>
        <!--jos sqlitetables on muu kuin true, piilotetaan input kenttä-->
        {%else%}
        <input hidden type="text" id="sqliteFile" name="sqliteFile">
        {%endif%}
        <!--
    <input type="checkbox"  id="sqlite" name="sqlite" onchange="runSqlite()">-->
    </form>
    <table id="sqliteTable" class="sqliteTable" border="1">

        {% for s in sqliteDatabases %}
        <tr>
            <td id="sqlite" class="sqlite">{{s}}</td>
        </tr>
        {%endfor%}
    </table>
    <form action="{{ url_for('sqliteScripts.runsqlite')}}" method="post">
        <input hidden type="text" id="selectedTable" name="selectedTable">
        <!--show table button näytetään vasta etsinnän tulosten yhteydessä if lohko toimii myös eri formeissa-->
        {% if sqliteTables==True%}
        <button id="showTableBtn" name="showTableBtn">Show table</button>
        {%endif%}
        <br>
    </form>
    <form action="{{ url_for('sqliteScripts.selfWriteQuery')}}" method="post">
        <input hidden type="text" id="selectedTable2" name="selectedTable">
        {% if sqliteTables==True%}
        <label id="queryLbl" for="query">Write SQLite query</label>
        <input type="checkbox" id="queryCB" name="queryCB" onclick="showQueryBox()">
        {%endif%}
        <br>
        <textarea hidden id="sqliteQuery" name="sqliteQuery"></textarea>
        <br>
        <button hidden id="runsqlitequery" name="runsqlitequery" class="runsqlitequery">Run query</button>
    </form>
    <script>
        //jquery funktio näyttää jokaisen _id-arvon ja siirtää sen input-kenttään kun sitä klikkaa hiirellä.
        jQuery(".sqlite").click(function () {
            //event.preventDefault();
            var text = jQuery(this).text();
            //katkaistaan merkkijono | merkin kohdalta
            var textSplit = text.split("|")
            //textSplit on taulukko, joten talletetaan muuttujaan taulukon ensimmäinen (0) alkio.
            var splittedText = textSplit[0]
            //trim poistaa välilyönnit
            var noWhiteSpace = splittedText.trim()
            console.log(noWhiteSpace);
            document.getElementById("sqliteFile").value = noWhiteSpace
            document.getElementById("sqliteFile2").value = noWhiteSpace
            document.getElementById("sqliteBase").value = noWhiteSpace
            sessionStorage.setItem('dbfile', noWhiteSpace)
            document.getElementById("sqliteFile").style.background = "yellow"
            document.getElementById("sqliteFile").onchange = backUp(document.getElementById("sqliteFile").value)
            var database = document.getElementById("sqliteFile").value
            document.getElementById("createTableLbl").innerText = "Create empty table to: " + noWhiteSpace
            document.getElementById("tableColumnsCB").hidden = false
            document.getElementById("tableColumns").innerText = "Create Table with columns"


        });
        jQuery(".sqlite").dblclick(function () {
            var text = jQuery(this).text()
            document.getElementById("dbPath").hidden = false
            document.getElementById("dbPath").value = text
            document.getElementById("accessBtn").hidden = false
        })

    </script>

    <form action="{{ url_for('mysqlScripts.readSelectedSql')}}" method="post">
        <div hidden id="mysqlForm">
            <select name="sqlDbs" id="sqlDbs" onchange="getMysqlDb(this)">
                <option value="default" selected>Select Database</option>
                <!--mysql tietokantojen näyttö select komponentissa-->
                {% for s in sqls %}
                <option value="">{{s}}</option>
                {% endfor %}
            </select>
            <input type="text" id="selectedSQL" name="selectedSQL">
        </div>
    </form>

    <!--näytetään stats.html sivu-->
    {% include 'stats.html' %}

</body>

</html>